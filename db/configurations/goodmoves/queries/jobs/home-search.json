{
  "_source": [
    "rendered.goodmoves_map",
    "geo_vacancy_coords",
    "Id",
    "title"
  ],
  "size": "1000",
  "query": {
    "bool": {
      {{#ifAny request.body.sectors request.body.roles request.body.statuses request.body.distance request.body.bounds}}
      "filter": [
        {{#if request.body.sectors}}
        {
          "terms": {
            "sectors": {{{stringify request.body.sectors}}}
          }
        }
        {{#ifAny request.body.roles request.body.statuses request.body.distance request.body.bounds}},{{/ifAny}}
        {{/if}}
        {{#if request.body.roles}}
        {
          "terms": {
            "roles": {{{stringify request.body.roles}}}
          }
        }
        {{#ifAny request.body.statuses request.body.distance request.body.bounds}},{{/ifAny}}
        {{/if}}
        {{#if request.body.statuses}}
        {
          "terms": {
            "status": {{{stringify request.body.statuses}}}
          }
        }
        {{#ifAny request.body.distance request.body.bounds}},{{/ifAny}}
        {{/if}}
        {{#if request.body.distance}}
        {
          "geo_distance": {
            "distance": "{{request.body.distance}}meters",
            "geo_vacancy_coords": {
              "lat": {{request.body.lat}},
              "lon": {{request.body.lng}}
            }
          }
        }
        {{#ifAny request.body.bounds}},{{/ifAny}}
        {{/if}}
        {{#if request.body.bounds}}
        {
          "geo_bounding_box": {
            "geo_vacancy_coords": {
              "top_left": {
                "lat": {{request.body.bounds.northEast.latitude}},
                "lon": {{request.body.bounds.southWest.longitude}}
              },
              "bottom_right": {
                "lat": {{request.body.bounds.southWest.latitude}},
                "lon": {{request.body.bounds.northEast.longitude}}
              }
            }
          }
        }
        {{/if}}
      ]
      {{#if request.body.keywords}},{{/if}}
      {{/ifAny}}
      {{#if request.body.keywords}}
      "must": [
        {
          "query_string": {
            "query": {{{stringify (join request.body.keywords " AND ")}}},
            "default_field": "text_bag",
            "default_operator": "AND",
            "analyzer": "snowball"
          }
        }
      ]
      {{/if}}
    }
  }
}
