{
    "size": 12,
    "from": {{multiply (subtract (default request.params.query.page 1) 1) 12}},
    "_source": [
        "slug",
        "title",
        "rendered.charter_search_result"
    ],
    "query": {
        "bool": {
            "filter": [
                {{#if request.params.query.sector}}
                    {
                        "term": {
                            "sector": "{{request.params.query.sector}}"
                        }
                    }{{#if request.params.query.category}},{{/if}}
                {{/if}}
                {{#if request.params.query.category}}
                    {
                        "term": {
                            "category": "{{request.params.query.category}}"
                        }
                    }
                {{/if}}
            ],
            "must": [
                {{#if request.params.query.q}}
                    {
                        "query_string": {
                            "query": "{{request.params.query.q}}",
                            "default_operator": "AND",
                            "analyzer": "snowball"
                        }
                    }
                {{/if}}
            ]
        }
    },
    "sort": {
        {{#if request.params.query.sort}}"slug": "asc"{{else}}"date_signed": "desc"{{/if}}
    }
}
