{{#if regions ~}}
  {{>queries_terms field="region_group_slug" terms=regions}},
{{else}}
  {
    "exists": {
      "field": "title"
    }
  },
{{/if ~}}
{{#ifAll location lat lng distance ~}}
  {
    "geo_distance": {
      "distance": "{{default distance "8.04672"}}km",
      "geo_vacancy_coords": {
        "lat": {{lat}},
        "lon": {{lng}}
      }
    }
  }
  {{#compare @root.route.name "!==" "vacancy_map" ~}},
    {
      "term": {
        "home_based": true
      }
    }
  {{else}}
    {{#if home_based ~}},
      {
        "term": {
          "home_based": true
        }
      }
    {{/if ~}}
  {{/compare ~}}
{{else}}
  {{#if home_based ~}}
    {{#if regions ~}}
      {
        "exists": {
          "field": "title"
        }
      },
    {{/if ~}}
    {
      "term": {
        "home_based": true
      }
    }
  {{else}}
    {
      "exists": {
        "field": "title"
      }
    }
  {{/if ~}}
{{/ifAll ~}}
