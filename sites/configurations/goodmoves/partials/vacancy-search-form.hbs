{{#*inline "term_checkbox"}}
  <div class="mdc-form-field">
    <div class="mdc-checkbox">
      <input type="checkbox" class="mdc-checkbox__native-control" id="{{instance_id}}_{{field}}_{{slug}}" name="{{#compare field "===" "type"}}{{field}}{{else}}{{field}}[]{{/compare}}" value="{{slug}}"{{#if (contains selected slug)}} checked{{/if}} />
      <div class="mdc-checkbox__background">
        <svg class="mdc-checkbox__checkmark"
        viewBox="0 0 24 24">
        <path class="mdc-checkbox__checkmark-path"
        fill="none"
        stroke="white"
        d="M1.73,12.91 8.1,19.28 22.79,4.59"/></svg>
        <div class="mdc-checkbox__mixedmark"></div>
      </div>
    </div>
    <label for="{{instance_id}}_{{field}}_{{slug}}">
      {{{default value.key value}}}
    </label>
  </div>
{{/inline}}

<div class="mdc-drawer__content">
  <h2 class="mdc-drawer__content-heading hide-sm mdc-drawer--occasional-ie11">Search jobs</h2>
  <div id="search-tab-bar" class="mdc-tab-bar mdc-tab-bar--fullwidth search-tab-bar mdc-drawer--occasional-ie11" data-mdc-auto-init="MDCTabBar">
    <a href="/search{{@root.request.url.search}}" class="mdc-tab{{#compare @root.request.url.pathname "===" "/search"}} mdc-tab--active{{/compare}} details-tab" id="detailed-results">
      <span class="far fa-list fa-fw" title="List"></span>
      List
    </a>
    <a href="/map{{@root.request.url.search}}" class="mdc-tab{{#compare @root.request.url.pathname "===" "/map"}} mdc-tab--active{{/compare}} map-tab">
      <span class="far fa-map-marker-alt fa-fw" title="Map"></span>
      Map
    </a>
    <span class="mdc-tab-bar__indicator"></span>
  </div>
  <form action="/{{#compare @root.request.url.pathname "/map"}}map{{else}}search{{/compare}}" method="GET" class="search-form" novalidate>
    <input type="hidden" name="sort" value="{{@root.request.params.query.sort}}" id="{{instance_id}}-sort">
    <div class="h-padding">
      <div class="mdc-text-field mdc-text-field--box mdc-text-field--with-leading-icon" data-mdc-auto-init="MDCTextField">
        <span class="far fa-search mdc-text-field__icon" tabindex="-1"></span>
        <input type="text" id="{{instance_id}}-keywords" name="keywords" class="mdc-text-field__input mdc-text-field--fullwidth" value="{{@root.request.params.query.keywords}}" data-lpignore="true" autocomplete="off">
        <label class="mdc-floating-label" for="keywords">
          Keywords
        </label>
        <div class="mdc-line-ripple"></div>
      </div>
    </div>

    <div class="h-padding">
      <div class="mdc-layout-grid">
        <div class="mdc-layout-grid__inner">
          <div class="mdc-layout-grid__cell mdc-layout-grid__cell--span-8-desktop mdc-layout-grid__cell--span-8-tablet mdc-layout-grid__cell--span-4-phone">
            <div class="mdc-text-field mdc-text-field--box mdc-text-field--with-leading-icon" data-mdc-auto-init="MDCTextField">
              <span class="far fa-map-marker-alt mdc-text-field__icon geo-lookup" tabindex="0" title="Find my location" role="button" style="pointer-events: initial !important;"></span>
              <input type="text" id="{{instance_id}}-location" name="location" class="mdc-text-field__input mdc-text-field--fullwidth search-location" value="{{#ifAll @root.request.params.query.lat @root.request.params.query.lng}}{{@root.request.params.query.location}}{{/ifAll}}" placeholder="" data-lpignore="true" data-location-options='
                {
                  "types": ["(regions)"],
                  "componentRestrictions": {
                    "country": "gb"
                  }
                }' data-location-lat="[name='lat']" data-location-lng="[name='lng']" data-location-services=".geo-lookup">
              <label class="mdc-floating-label" for="{{instance_id}}-location">
                Location
              </label>
              <div class="mdc-line-ripple"></div>
            </div>
            <!-- <div class="after-textfield-action geo-lookup">Find me</div> -->
          </div>
          <div class="mdc-layout-grid__cell mdc-layout-grid__cell--span-4-desktop mdc-layout-grid__cell--span-8-tablet mdc-layout-grid__cell--span-4-phone">
            <div class="mdc-select mdc-select--box mdc-drawer--occasional-ie11" data-mdc-auto-init="MDCSelect">
              <select data-location="{{instance_id}}-location" class="mdc-select__native-control search-distance" id="{{instance_id}}-distance" name="distance">
                <option value="8.04672"{{#compare @root.request.params.query.distance "8.04672"}} selected{{/compare}}>5 miles</option>
                <option value="16.09344"{{#compare @root.request.params.query.distance "16.09344"}} selected{{/compare}}>10 miles</option>
                <option value="40.2336"{{#compare @root.request.params.query.distance "40.2336"}} selected{{/compare}}>25 miles</option>
                <option value="80.4672"{{#compare @root.request.params.query.distance "80.4672"}} selected{{/compare}}>50 miles</option>
                <option value=""{{#compare @root.request.params.query.distance ""}} selected{{/compare}}>no limit</option>
              </select>
              <label class="mdc-floating-label" for="{{instance_id}}-distance">
                Within
              </label>
              <div class="mdc-line-ripple"></div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- <input type="hidden" data-location-inner-ne="{{instance_id}}-location" name="inner-ne" value="{{@root.request.params.query.inner-ne}}" id="{{instance_id}}-location-inner-ne">
    <input type="hidden" data-location-inner-sw="{{instance_id}}-location" name="inner-sw" value="{{@root.request.params.query.inner-sw}}" id="{{instance_id}}-location-inner-sw">
    <input type="hidden" data-location-outer-ne="{{instance_id}}-location" name="outer-ne" value="{{@root.request.params.query.outer-ne}}" id="{{instance_id}}-location-outer-ne">
    <input type="hidden" data-location-outer-sw="{{instance_id}}-location" name="outer-sw" value="{{@root.request.params.query.outer-sw}}" id="{{instance_id}}-location-outer-sw"> -->
    <input type="hidden" name="lat" value="{{@root.request.params.query.lat}}" id="{{instance_id}}-lat">
    <input type="hidden" name="lng" value="{{@root.request.params.query.lng}}" id="{{instance_id}}-lng">

    <h3 class="mdc-drawer__content-heading cursor-pointer noselect mdc-drawer--occasional-ie11" data-collapse-target="#{{instance_id}}-salary-collapse" role="button" aria-pressed="false" aria-label="Show salary search options" tabindex="0">
      Salary
      <span class="mdc-icon-toggle pull-right">
        <i class="far {{#if (getProperty @root.request.params.query "salary_min")}}fa-chevron-up{{else}}fa-chevron-down{{/if}}" aria-hidden="true"></i>
      </span>
    </h3>
    <div id="{{instance_id}}-salary-collapse"{{#unless (getProperty @root.request.params.query "salary_min")}}{{#unless (getProperty @root.request.params.query "salary_max")}} style="display: none;"{{/unless}}{{/unless}}>
      <div class="h-padding">
        <div class="mdc-text-field mdc-text-field--box mdc-text-field--with-leading-icon" data-mdc-auto-init="MDCTextField" novalidate>
          <span class="far fa-arrow-alt-from-left mdc-text-field__icon" tabindex="-1"></span>
          <input type="number" id="{{instance_id}}-salary_min" step="1000" min="0" max="1000000" name="salary_min" class="mdc-text-field__input mdc-text-field--fullwidth" value="{{@root.request.params.query.salary_min}}" data-lpignore="true" novalidate>
          <label class="mdc-floating-label" for="{{instance_id}}-salary_min">
            Minimum salary
          </label>
          <div class="mdc-line-ripple"></div>
        </div>
      </div>

      <div class="h-padding">
        <div class="mdc-text-field mdc-text-field--box mdc-text-field--with-leading-icon" data-mdc-auto-init="MDCTextField" novalidate>
          <span class="far fa-arrow-alt-to-right mdc-text-field__icon" tabindex="-1"></span>
          <input type="number" id="{{instance_id}}-salary_max" step="1000" min="0" max="1000000" name="salary_max" class="mdc-text-field__input mdc-text-field--fullwidth" value="{{@root.request.params.query.salary_max}}" data-lpignore="true" novalidate>
          <label class="mdc-floating-label" for="{{instance_id}}-salary_max">
            Maximum salary
          </label>
          <div class="mdc-line-ripple"></div>
        </div>
      </div>
    </div>

    {{#each (split "statuses,regions,roles,sectors" ",")}}
      <h3 class="mdc-drawer__content-heading cursor-pointer noselect mdc-drawer--occasional-ie11" data-collapse-target="#{{../instance_id}}-{{this}}-collapse" role="button" aria-pressed="false" aria-label="Show {{getProperty @root.context.metaData.termTypeLabels (concat this ".plural")}}" tabindex="0">
        {{getProperty @root.context.metaData.termTypeLabels (concat this ".plural")}}
        <span class="mdc-icon-toggle pull-right">
          <i class="far {{#if (getProperty @root.request.params.query this)}}fa-chevron-up{{else}}fa-chevron-down{{/if}}" aria-hidden="true"></i>
        </span>
      </h3>
      <div class="mdc-drawer--occasional-ie11" id="{{../instance_id}}-{{this}}-collapse"{{#unless (getProperty @root.request.params.query this)}} style="display: none;"{{/unless}}>
        {{#compare this "===" "regions" ~}}
          {{#compare (length @root.data.supplimentaryResponses.types.aggregations.countries.buckets) ">" 1 ~}}
            {{#each @root.data.supplimentaryResponses.types.aggregations.countries.buckets ~}}
              {{#if key ~}}
                {{#compare (length @root.data.supplimentaryResponses.types.aggregations.countries.buckets) ">" 1 ~}}
                  <h3 class="mdc-typography--headline7">{{{key}}}</h3>
                {{/compare ~}}
              {{/if ~}}
              {{#each this.regions_slugs.buckets ~}}
                {{#if key ~}}
                  {{> term_checkbox slug=key field="regions" selected=@root.request.params.query.regions instance_id=../../../instance_id value=(lookup ../this.regions.buckets @index)}}
                {{/if ~}}
              {{/each ~}}
            {{/each ~}}
            {{#compare (length @root.data.supplimentaryResponses.types.aggregations.home_based.buckets) ">" 1 ~}}
              <h3 class="mdc-typography--headline7">Other</h3>
              {{> term_checkbox slug="true" field="home_based" selected=@root.request.params.query.home_based instance_id=../instance_id value="Home-based"}}
            {{/compare ~}}
          {{/compare ~}}
        {{else}}
          {{#each (getProperty @root.data.supplimentaryResponses.types.aggregations (concat this "_slugs.buckets")) ~}}
            {{#if key ~}}
              {{> term_checkbox slug=key field=../this selected=(getProperty @root.request.params.query ../this) instance_id=../../instance_id value=(lookup (getProperty @root.data.supplimentaryResponses.types.aggregations (concat ../this ".buckets")) @index)}}
            {{/if ~}}
          {{/each ~}}
        {{/compare ~}}
      </div>
    {{/each}}

    <div class="h-margin v-margin mdc-drawer--occasional-ie11">
      <button class="mdc-button mdc-button--raised mdc-button--large mdc-button--fullwidth mdc-ripple-surface mdc-ripple-surface--primary" type="submit" id="{{instance_id}}-search-submit" data-mdc-auto-init="MDCRipple">
        <span class="far fa-search fa-fw mdc-list-item__graphic" aria-hidden="true"></span>
        Search
      </button>
    </div>
  </form>
</div>
