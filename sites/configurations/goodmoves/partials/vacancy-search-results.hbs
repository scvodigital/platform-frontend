{{> banner_ads}}

{{> search_info paging=data.search_data.detailed_results.pagination}}

<aside id="save-search-dialog"
  class="mdc-dialog"
  role="alertdialog"
  aria-labelledby="save-search-dialog-label"
  aria-describedby="save-search-dialog-description"
  data-mdc-auto-init="MDCDialog">
  <form action="/save-search{{{@root.request.url.search}}}" method="POST" class="mdc-dialog__surface">
    <header class="mdc-dialog__header">
      <h2 id="save-search-dialog-label" class="mdc-dialog__header__title">
        Give your search a name
      </h2>
    </header>
    <section id="save-search-dialog-description" class="mdc-dialog__body">
      <div class="mdc-text-field mdc-text-field--box" data-mdc-auto-init="MDCTextField">
        <p>
        {{~#each @root.request.params.query.roles~}}
          {{~getProperty (getProperty @root.data.termsMaps.roles.slugsMap this) "term"~}}
        {{~/each~}}
        </p>
        <input type="text" id="saved-search-name" name="name" class="mdc-text-field__input" value="
{{~#with @root.request.params.query~}}
  {{~#if keywords~}}
    {{~keywords~}}
    {{~#ifAny roles sectors statuses}}, {{/ifAny~}}
  {{~/if~}}
  {{~#if roles~}}
    {{~#each (arrayify roles)~}}
      {{~getProperty (getProperty @root.data.termsMaps.roles.slugsMap this) "term"~}}
      {{~#unless @last}}, {{/unless~}}
    {{~/each~}}
    {{~#ifAny sectors statuses}}, {{/ifAny~}}
  {{~/if~}}
  {{~#if sectors~}}
    {{~#each (arrayify sectors)~}}
      {{~getProperty (getProperty @root.data.termsMaps.sectors.slugsMap this) "term"~}}
      {{~#unless @last}}, {{/unless~}}
    {{~/each~}}
    {{~#ifAny statuses}}, {{/ifAny~}}
  {{~/if~}}
  {{~#if statuses~}}
    {{~#each (arrayify statuses)~}}
      {{~getProperty (getProperty @root.data.termsMaps.statuses.slugsMap this) "term"~}}
      {{~#unless @last}}, {{/unless~}}
    {{~/each~}}
  {{~/if}}
  {{~#if location~}} in {{location}} {{/if~}}
  {{~#if salary_min~}}
    {{~#if salary_max}} between £{{addCommas salary_min}} and {{addCommas salary_max}}
    {{~else}} over £{{addCommas salary_min}}
    {{~/if~}}
  {{~else~}}
    {{~#if salary_max}} up to £{{addCommas salary_max}}
    {{~/if}}
  {{~/if~}}
{{~/with~}}
        ">
        <label for="saved-search-name" class="mdc-floating-label mdc-floating-label--float-above">Save search</label>
        <div class="mdc-line-ripple"></div>
      </div>
      Set up email alerts
      <div class="mdc-switch">
        <input type="checkbox" id="email-switch-0" class="mdc-switch__native-control" role="switch" checked="checked" name="subscribe">
        <div class="mdc-switch__background">
          <div class="mdc-switch__knob"></div>
        </div>
      </div>
      <label for="email-switch-0">
        <span class="far fa-envelope fa-2x"></span>
      </label>
    </section>
    <footer class="mdc-dialog__footer">
      <button type="button" class="mdc-button mdc-dialog__footer__button mdc-dialog__footer__button--cancel">Cancel</button>
      <button type="submit" class="mdc-button mdc-dialog__footer__button mdc-dialog__footer__button--accept">Save</button>
    </footer>
  </form>
  <div class="mdc-dialog__backdrop"></div>
</aside>

<div class="mdc-layout-grid head">
  <div class="mdc-layout-grid__inner">
    <div class="mdc-layout-grid__cell mdc-layout-grid__cell--span-3-desktop mdc-layout-grid__cell--span-8-tablet mdc-layout-grid__cell--span-4-phone">
      {{#with (querystringify (obj)
              keywords=@root.request.params.query.keywords
              salary_min=@root.request.params.query.salary_min
              salary_max=@root.request.params.query.salary_max
              roles=@root.request.params.query.roles
              sectors=@root.request.params.query.sectors
              statuses=@root.request.params.query.statuses
              distance=@root.request.params.query.distance
              lat=@root.request.params.query.lat
              lng=@root.request.params.query.lng
              location=@root.request.params.query.location
            )}}
        {{#with (itemAt @root.data.saved_searches.items (indexOf (map @root.data.saved_searches.items (getProp 'querystring')) this))}}
          <span class="mdc-typography--headline5">{{name}}</span>
          {{> subscription_toggle name=name subscribed=subscribed formClasses="inline-form"}}
          {{> delete_search name=name formClasses="inline-form"}}
        {{else}}
          <button class="mdc-button mdc-button--raised mdc-button--large save-search" id="save-search-button" data-dialog-target="#save-search-dialog">
            <span class="far fa-search-plus mdc-list-item__graphic" aria-hidden="true"></span>
            Save/email this search
          </button>
        {{/with}}
      {{/with}}
      <!-- <form class="mdc-layout-grid__cell mdc-layout-grid__cell--span-3-desktop mdc-layout-grid__cell--span-8-tablet mdc-layout-grid__cell--span-4-phone" action="/save-search{{{@root.request.url.search}}}" method="POST">
        <div class="mdc-text-field mdc-text-field--box mdc-text-field--with-trailing-icon" data-mdc-auto-init="MDCTextField">
          <input type="text" id="saved-search-name" name="name" class="mdc-text-field__input">
          <label for="saved-search-name" class="mdc-floating-label mdc-floating-label--float-above">Save search</label>
          <button class="mdc-icon-button mdc-text-field__icon" tabindex="0" role="role">
            <span class="far fa-save" aria-hidden="true"></span>
          </button>
          <div class="mdc-line-ripple"></div>
        </div>
      </form> -->
      <!-- {{#compare
        (indexOf
          (map @root.data.saved_searches.items (getProp 'querystring'))
          (querystringify (obj)
            keywords=@root.request.params.query.keywords
            salary_min=@root.request.params.query.salary_min
            salary_max=@root.request.params.query.salary_max
            roles=@root.request.params.query.roles
            sectors=@root.request.params.query.sectors
            statuses=@root.request.params.query.statuses
          )
        ) ">" -1
      }}
      <div class="mdc-text-field mdc-text-field--box mdc-text-field--with-trailing-icon noselect" data-mdc-auto-init="MDCTextField">
        <input type="text" id="saved-search-name" name="name" class="mdc-text-field__input noselect" disabled="disabled"
        value="{{getProperty
          (itemAt
            @root.data.saved_searches.items
            (indexOf
              (map @root.data.saved_searches.items (getProp 'querystring'))
              (querystringify (obj)
                keywords=@root.request.params.query.keywords
                salary_min=@root.request.params.query.salary_min
                salary_max=@root.request.params.query.salary_max
                roles=@root.request.params.query.roles
                sectors=@root.request.params.query.sectors
                statuses=@root.request.params.query.statuses
              )
            )
          ) 'name'
        }}">
        <label for="saved-search-name" class="mdc-floating-label mdc-floating-label--float-above noselect">Saved search</label>
        <button class="mdc-icon-button mdc-text-field__icon noselect" tabindex="0">
          <span class="far fa-check-square" aria-hidden="true"></span>
        </button>
        <div class="mdc-line-ripple"></div>
      </div>
      {{else}}
      <form class="mdc-layout-grid__cell mdc-layout-grid__cell--span-3-desktop mdc-layout-grid__cell--span-8-tablet mdc-layout-grid__cell--span-4-phone" action="/save-search{{{@root.request.url.search}}}" method="POST">
        <div class="mdc-text-field mdc-text-field--box mdc-text-field--with-trailing-icon" data-mdc-auto-init="MDCTextField">
          <input type="text" id="saved-search-name" name="name" class="mdc-text-field__input">
          <label for="saved-search-name" class="mdc-floating-label mdc-floating-label--float-above">Save search</label>
          <button class="mdc-icon-button mdc-text-field__icon" tabindex="0" role="role">
            <span class="far fa-save" aria-hidden="true"></span>
          </button>
          <div class="mdc-line-ripple"></div>
        </div>
      </form>
      {{/compare}} -->
    </div>
    <div class="mdc-layout-grid__cell mdc-layout-grid__cell--span-6-desktop mdc-layout-grid__cell--span-4-tablet mdc-layout-grid__cell--span-4-phone">
      {{> pagination paging=data.search_data.detailed_results.pagination}}
    </div>
    <div class="mdc-layout-grid__cell mdc-layout-grid__cell--span-3-desktop mdc-layout-grid__cell--span-4-tablet mdc-layout-grid__cell--span-4-phone">
      <form action="{{{request.url.path}}}" method="GET">
        <input type="hidden" name="keywords" value="{{request.params.query.keywords}}" />
        <input type="hidden" name="location" value="{{request.params.query.location}}" />
        <input type="hidden" name="distance" value="{{request.params.query.distance}}" />
        <input type="hidden" name="lat" value="{{request.params.query.lat}}" />
        <input type="hidden" name="lng" value="{{request.params.query.lng}}" />
        <input type="hidden" name="salary_min" value="{{request.params.query.salary_min}}" />
        <input type="hidden" name="salary_max" value="{{request.params.query.salary_max}}" />
        <div class="mdc-select mdc-select--box pull-right" data-mdc-auto-init="MDCSelect">
          <select class="mdc-select__native-control" id="sort" name="sort" onchange="this.form.submit();">
            <option value=""{{#compare request.params.query.sort "===" ""}} selected{{/compare}}>Relevance</option>
            <option value="distance"{{#compare request.params.query.sort "===" "distance"}} selected{{/compare}}{{#compare request.params.query.location "===" ""}} disabled{{/compare}}>Distance</option>
            <option value="closing_soon"{{#compare request.params.query.sort "===" "closing_soon"}} selected{{/compare}}>Closing soon</option>
            <option value="newest"{{#compare request.params.query.sort "===" "newest"}} selected{{/compare}}>Newest</option>
            <option value="oldest"{{#compare request.params.query.sort "===" "oldest"}} selected{{/compare}}>Oldest</option>
            <option value="salary_high"{{#compare request.params.query.sort "===" "salary_high"}} selected{{/compare}}>Salary - high to low</option>
            <option value="salary_low"{{#compare request.params.query.sort "===" "salary_low"}} selected{{/compare}}>Salary - low to high</option>
          </select>
          <label class="mdc-floating-label mdc-floating-label--float-above" for="sort">
            Sort
          </label>
        </div>
      </form>
    </div>
  </div>
</div>

{{#each data.search_data.detailed_results.hits.hits ~}}
{{> vacancy_search_result _source}}
{{/each ~}}

<div class="foot">
  {{> pagination paging=data.search_data.detailed_results.pagination}}
</div>
