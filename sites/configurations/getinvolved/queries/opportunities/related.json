{
  "size": 4,
  "_source": [
    "Id",
    "slug",
    "top_job",
    "description",
    "title",
    "geo_coords",
    "location",
    "salary",
    "salary_min",
    "role_status_list",
    "active",
    "closing_date",
    "start_at",
    "end_at",
    "organisation.slug",
    "organisation.name",
    "roles_slugs",
    "sectors_slugs",
    "organisation.has_logo",
    "organisation.logo_url",
    "remuneration_type"
  ],
  "query": {
    "bool": {
      "filter": [
        {{>queries_opportunity_common_filters request.params.query}}
      ],
      "should": [
        {
          "match": {
            "remuneration_type" : {
              "query" : "{{@root.data.primaryResponse.hits.hits.[0]._source.remuneration_type}}",
              "operator" : "and",
              "zero_terms_query": "all"
            }
          }
        },
        {
          "match": {
            "title" : {
              "query" : "{{@root.data.primaryResponse.hits.hits.[0]._source.title}}",
              "operator" : "and",
              "zero_terms_query": "all"
            }
          }
        },
        {
          "terms": {
            "client_group-slugs": {{{stringify (arrayify @root.data.primaryResponse.hits.hits.[0]._source.client_group-slugs)}}}
          }
        },
        {
          "terms": {
            "work_type-slugs": {{{stringify (arrayify @root.data.primaryResponse.hits.hits.[0]._source.work_type-slugs)}}}
          }
        }
      ],
      "must_not": [
        {
          "term": {
            "Id": "{{@root.data.primaryResponse.hits.hits.[0]._source.Id}}"
          }
        }
      ]
    }
  }
}
