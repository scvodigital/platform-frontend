[
{{#if @root.data.search_data}}
  {{#eachJoin @root.data.notifications.subscriptions.[0] ","}}
    {{#ifAny
      (getProperty @root.context.metaData.campaignConfig (concat campaign '.sendIfEmpty'))
      (any (getProperty @root.data.search_data (concat (slugify campaign) "-" (slugify email) '.hits.hits')))
    }}
      {
        "from": {{{stringify (getProperty @root.context.metaData.campaignConfig (concat campaign '.from'))}}},
        "to": {{{stringify email}}},
        "o:tag": {{{stringify campaign}}},
        "o:tracking": true,
        "tag": {{{stringify campaign}}},
        "id": {{{stringify campaign}}},
        "connectionName": {{{stringify (getProperty @root.context.metaData.campaignConfig (concat campaign '.mailgunConnection'))}}},
        "subject": 
          {{~#blockStringify this ~}}
            {{~> 
              (getProperty @root.context.metaData.campaignConfig (concat campaign '.subjectPartial'))
              subscription=this
              searchData=(getProperty @root.data.search_data (concat (slugify campaign) "-" (slugify email)))
              campaignConfig=(getProperty @root.context.metaData.campaignConfig campaign)          
            ~}}
          {{~/blockStringify}},
        "html": 
          {{~#blockStringify this ~}}
            {{~> 
              (getProperty @root.context.metaData.campaignConfig (concat campaign '.bodyPartial'))
              subscription=this
              searchData=(getProperty @root.data.search_data (concat (slugify campaign) "-" (slugify email)))
              campaignConfig=(getProperty @root.context.metaData.campaignConfig campaign)          
            ~}}
          {{~/blockStringify}}
      }
    {{/ifAny}}
  {{/eachJoin}}
{{/if}}
]
