[
{{#if @root.data.search_data}}
  {{#eachJoin @root.data.notifications.subscriptions.[1] ","}}
    "{{slugify (concat campaign " " email)}}",
    {{{slugify @root.data.search_data.goodmoves-saved-searches-tonicbluegmailcom}}},
    {{#ifAny
      (getProperty @root.context.metaData.campaignConfig (concat campaign '.sendIfEmpty'))
      (any (getProperty @root.data.search_data (slugify (concat campaign " " email)) '.hits.hits'))
    }}
      {
        "from": {{{stringify (getProperty @root.context.metaData.campaignConfig (concat campaign '.from'))}}},
        "to": {{{stringify email}}},
        "o:tag": {{{stringify campaign}}},
        "o:tracking": true,
        "o:testmode": true,
        "tag": {{{stringify campaign}}},
        "id": {{{stringify campaign}}},
        "connectionName": {{{stringify (getProperty @root.context.metaData.campaignConfig (concat campaign '.mailgunConnection'))}}},
        "subject": 
          {{~#blockStringify this ~}}
            {{~> 
              (getProperty @root.context.metaData.campaignConfig (concat campaign '.subjectPartial'))
              subscription=this
              searchData=(getProperty @root.data.search_data (slugify (concat campaign " " email)))
              campaignConfig=(getProperty @root.context.metaData.campaignConfig campaign)          
            ~}}
          {{~/blockStringify}},
        "html": 
          {{~#blockStringify this ~}}
            {{~> 
              (getProperty @root.context.metaData.campaignConfig (concat campaign '.bodyPartial'))
              subscription=this
              searchData=(getProperty @root.data.search_data (slugify (concat campaign " " email)))
              campaignConfig=(getProperty @root.context.metaData.campaignConfig campaign)          
            ~}}
          {{~/blockStringify}}
      }
    {{else}}
    "Nothing to send"
    {{/ifAny}}
  {{/eachJoin}}
{{/if}}
]
