{
	"size": 0,
    "_source": [
        "rendered.scvo_list"
    ],
	"query": {
		"bool": {
			"must": [
				{
					"term": {
                        "is_active": true
                    }
				}
                {{#ifAny query.city query.department}},{{/ifAny}}
                {{#if query.city}}
                    {
                        "term": {
                            "city_slug": "{{query.city}}"
                        }
                    }
                    {{#ifAny query.department}},{{/ifAny}}
                {{/if}}
                {{#if query.department}}
                    {
                        "term": {
                            "department_slug": "{{query.department}}"
                        }
                    }
                {{/if}}
			]
		}
	},
	"aggs": {
		"query": {
			"terms": {
				"field": "{{firstItem (split query.grouping '-')}}",
				"order": {
                    "_term": "asc"
                },
                "size": 1000
			},
			"aggs": {
    			"staff": {
                    "top_hits": {
                        "size": 1000,
    					"sort": {
    						"name_last": "asc"
    					},
    					"_source": {
    						"includes": [
                                "rendered.scvo_list"
                            ]
    					}
                    }
				}
			}
		}
	}
}
