{
    "size": 10,
    "from": {{multiply (subtract (default query.page 1) 1) 10}},
    "_source": [
        "title",
        "rendered.scvo_search_result"
    ],
	"highlight" : {
        "fields" : {
            "text_bag": {},
            "text_bag_boost": {}
        }
    },
    "query": {
        "function_score": {
        	"query": {
	        	"bool": {
	        		"must": [
                        {{#if query.type}}
                        {
                            "bool": {
                                "should": [
                                    {{#compare (getType query.type) "string"}}
                                        { "term": { "_type": "{{query.type}}" } },
                                    {{/compare}}
                                    {{#compare (getType query.type) "array"}}
                                        {{#each query.type}}
                                        { "term": { "_type": "{{this}}" } },
                                        {{/each}}
                                    {{/compare}}
                                    { "match_none": {} }
                                ]
                            }
                        },
                        {{/if}}
	        			{
		        			"bool": {
		        				"should": [
		        					{
					                    "query_string": {
					                        "query": {{{stringify query.q}}},
					                        "default_field": "text_bag",
					                        "default_operator": "AND",
					                        "analyzer": "snowball"
					                    }
					                },
					                {
					                    "query_string": {
					                        "query": {{{stringify query.q}}},
					                        "default_field": "text_bag_boost",
					                        "default_operator": "AND",
					                        "analyzer": "snowball",
					                        "boost": 10
					                    }
					                }	
		        				]
		        			}
	        			}
	        		]
                    {{#unless query.type}},
                    "should": [
	                    { "term" : { "_type" : { "value" : "scvo-cms-post",         "boost" : 5.0 } } },
	                    { "term" : { "_type" : { "value" : "scvo-event",            "boost" : 4.0 } } },
	                    { "term" : { "_type" : { "value" : "scvo-cms-page",         "boost" : 8.0 } } },
	                    { "term" : { "_type" : { "value" : "goodhq-organisation",   "boost" : 1.5 } } }
	        		]
                    {{/unless}}
	        	}
        	},
            "boost_mode": "multiply",
            "functions": [
        		{ 
        			"filter": { "term": { "_type": "scvo-cms-post" } },
        			"weight": "5",
        			"gauss": {
		                "publish_on": {
		                    "scale": "84d",
		                    "decay": "0.1"
		                }
		            }
        		}
            ]
        }
    }
}
