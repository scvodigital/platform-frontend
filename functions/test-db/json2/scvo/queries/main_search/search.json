{
    "size": 10,
    "from": {{multiply (subtract (default query.page 1) 1) 10}},
    "_source": [
        "title",
        "rendered.scvo_search_result"
    ],
	"highlight" : {
        "fields" : {
            "text_bag": {},
            "text_bag_boost": {}
        }
    },
    "query": {
        "function_score": {
        	"query": {
	        	"bool": {
	        		"must": [
                        {
                            "exists": {
                                "field": "rendered.scvo_search_result"
                            }
                        },
                        {{#if query.type}}
                        {
                            "bool": {
                                "should": [
                                    {{#compare (getType query.type) "string"}}
                                        {
                                            "term": {
                                                "_type": "{{query.type}}"
                                            }
                                        },
                                    {{/compare}}
                                    {{#compare (getType query.type) "array"}}
                                        {{#each query.type}}
                                        {
                                            "term": {
                                                "_type": "{{this}}"
                                            }
                                        },
                                        {{/each}}
                                    {{/compare}}
                                    {
                                        "match_none": {}
                                    }
                                ]
                            }
                        }{{#if query.q}},{{/if}}
                        {{/if}}
	        			{
		        			"bool": {
		        				"should": [
		        					{
					                    "query_string": {
					                        "query": {{{stringify (default query.q "")}}},
					                        "default_field": "text_bag",
					                        "default_operator": "AND",
					                        "analyzer": "snowball"
					                    }
					                },
					                {
					                    "query_string": {
					                        "query": {{{stringify (default query.q "")}}},
					                        "default_field": "text_bag_boost",
					                        "default_operator": "AND",
					                        "analyzer": "snowball",
					                        "boost": 10
					                    }
					                }
		        				]
		        			}
	        			}
	        		]
                    {{#unless query.type}},
                    "should": [
                        {
                            "term" : {
                                "_type" : {
                                    "value" : "scvo-event",
                                    "boost" : 2.0
                                }
                            }
                        },
	                    {
                            "term" : {
                                "_type" : {
                                    "value" : "scvo-cms-page",
                                    "boost" : 1.0
                                }
                            }
                        },
	                    {
                            "term" : {
                                "_type" : {
                                    "value" : "scvo-cms-page",
                                    "boost" : 8.0
                                }
                            }
                        },
	                    {
                            "term" : {
                                "_type" : {
                                    "value" : "oscr-charity",
                                    "boost" : -5.0
                                }
                            }
                        }
	        		]
                    {{/unless}}
	        	}
        	},
            "boost_mode": "multiply",
            "functions": [
                {
        			"filter": {
                        "term": {
                            "vacancy_status": "vacancy-closed"
                        }
                    },
        			"weight": "-1000"
        		},
                {
        			"filter": {
                        "term": {
                            "_type": "scvo-cms-post"
                        }
                    },
        			"weight": "3",
        			"gauss": {
		                "publish_on": {
		                    "scale": "120d",
		                    "decay": "0.1"
		                }
		            }
        		}
            ]
        }
    }
}
